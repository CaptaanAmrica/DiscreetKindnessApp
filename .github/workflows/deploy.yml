name: Build, Test, and Deploy to SharkASP.NET

on:
  push:
    branches:
      - master

jobs:
  build-test-deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0.x'

      - name: Restore Dependencies
        run: dotnet restore
        working-directory: ./
        continue-on-error: false

      - name: Build Application
        run: dotnet build --configuration Release --no-restore
        working-directory: ./
        continue-on-error: false

      - name: Run Tests
        run: dotnet test --no-build --verbosity normal
        working-directory: ./
        continue-on-error: false

      - name: Publish Application
        run: dotnet publish -c Release -o ./publish_output
        working-directory: ./
        continue-on-error: false

      - name: Install git-ftp
        run: |
          winget install --id=git-ftp.git-ftp --source=winget

      - name: Deploy via Git FTP
        run: |
          git ftp push --auto-init ^
                       --user "${{ secrets.FTP_USERNAME }}" ^
                       --passwd "${{ secrets.FTP_PASSWORD }}" ^
                         ftp://${{ secrets.FTP_SERVER }}/discreetkindnessapp/

